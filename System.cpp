#include "System.hpp"

#include "states/Arkanoid/Arkanoid.hpp"
#include "states/4096/4096.hpp"
#include "states/flappyBird/flappyBird.hpp"
#include "states/mainMenu.hpp"

_input_button_staticPrepare(keyA);
_input_button_staticPrepare(keyUp);
_input_button_staticPrepare(keyDown);
_input_button_staticPrepare(keyLeft);
_input_button_staticPrepare(keyRight);

_input_button_staticPrepare(keySuper);

const uint8_t splashScreen[] PROGMEM = {
	0xff,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x81,0xc1,0xe1,0xf1,0xf9,0x79,0x79,
	0x79,0x79,0x79,0xf9,0xf1,0xf1,0xe1,0x81,0x01,0x01,0x01,0xf9,0xf9,0xf9,0xf9,0x79,
	0x79,0x79,0x79,0x79,0xf9,0xf9,0xf1,0xe1,0xc1,0x01,0x01,0x81,0xc1,0xe1,0xf1,0xf9,
	0x79,0x79,0x79,0x79,0x79,0xf9,0xf1,0xf1,0xe1,0x81,0x01,0x09,0x39,0xf9,0xf9,0xf9,
	0xf1,0xc1,0x01,0x01,0x81,0xe1,0xf9,0xf9,0xf9,0x79,0x19,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,
	0xff,0xff,0x80,0x00,0x00,0x00,0x00,0xc1,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0xff,
	0xff,0xff,0xff,0x1e,0x1e,0x1e,0x1e,0x1e,0xbf,0xff,0xff,0xff,0xf1,0x00,0x00,0xff,
	0xff,0xff,0xff,0xff,0x80,0x00,0x00,0x00,0x00,0xc1,0xff,0xff,0xff,0xff,0x00,0x00,
	0x00,0x00,0x01,0x07,0x1f,0xff,0xff,0xfe,0xff,0x3f,0x0f,0x03,0x01,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x01,0x03,0x07,0x07,0x0f,0x0f,0x0f,0x0f,0x0f,0x1f,0x1f,0x1f,0x1f,0x10,
	0x00,0x00,0x00,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x07,0x07,
	0x01,0x00,0x00,0x00,0x01,0x03,0x07,0x07,0x0f,0xef,0xef,0x6f,0xef,0xef,0xc7,0x67,
	0xe3,0xe0,0xc0,0x00,0xc0,0xe0,0x60,0x60,0xe0,0xcf,0x0f,0xef,0xef,0x60,0x60,0xe0,
	0xc0,0x00,0x00,0xc0,0xe0,0x60,0x60,0xe0,0xc0,0x00,0x00,0xff,0xff,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x0f,0x00,
	0x00,0x0f,0x0f,0x00,0x0f,0x0f,0x0f,0x00,0x07,0x0f,0x0c,0x0c,0x0f,0x07,0x00,0x0f,
	0x0f,0x00,0x00,0x0f,0x0f,0x00,0x00,0x07,0x0f,0x0c,0x0c,0x0f,0x07,0x00,0x00,0xff,
	0xff,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xff,0xff,0x80,0x80,0x9f,0xbf,0xb1,0xb5,0xb5,0xbf,0x9f,0x80,0x80,
	0x80,0x9d,0x95,0x97,0x80,0x9f,0x91,0x9f,0x80,0x91,0x9f,0x90,0x80,0x97,0x95,0x9f,
	0x80,0x80,0x80,0x8e,0x91,0xb1,0xae,0x80,0x9f,0x80,0x9f,0x84,0x8a,0x91,0x80,0x8e,
	0x91,0x91,0x80,0x9f,0x80,0x9f,0x84,0x8a,0x91,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xff
};

void setup()
{
	keyA::init();
	
	keySuper::init();
	
	keyUp::init();
	keyDown::init();
	keyLeft::init();
	keyRight::init();
	
	Light::init();
	
	
	Display::init();
}

void System::start(void)
{
	setup();
	Display::drawBitmap(0,0,Display::Width,Display::Hight,splashScreen);
	Display::display();
	_delay_ms(1000);
	
	int8_t state = -1;
	while(true)
	{
		//MainMenu().run();
		switch(state)
		{
			case STATEID_4096:
				state = States::Game4096().run();
			break;
			case STATEID_FLAPPYBIRD:
				state = States::flappyBird().run();
			break;
			case STATEID_ARKANOID:
				state = States::Arkanoid().run();
			break;
			default:
				state = States::MainMenu::run();
			break;
		}
	}
}